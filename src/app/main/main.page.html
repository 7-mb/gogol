<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      SpeciesID
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-list>
    <ion-item *ngIf="response != ''">
      <pre>Response: {{response}}</pre>
    </ion-item>
    <ion-item *ngIf="selectedAttributes.includes(Attribute.LatLon) || selectedAttributes.includes(Attribute.Date)">
      <ion-label *ngIf="selectedAttributes.includes(Attribute.LatLon)">
        <h3>Latitude / Longitude</h3>
        <p><small>{{photoService.currentLat | number:'1.7-7' }} /
            {{photoService.currentLon | number:'1.7-7' }}</small></p>
      </ion-label>
      <ion-label class="ion-text-right" *ngIf="selectedAttributes.includes(Attribute.Date)">
        <h3>Date</h3>
        <p><small>{{date}}</small></p>
      </ion-label>
    </ion-item>
    <ion-item>
      <ion-label>
        <h3>Active API is {{selectedApi.name}}</h3>
        <p><small>{{selectedApi.url}}</small></p>
      </ion-label>
    </ion-item>
    <ion-item (click)="configureApisClicked()">
      <ion-icon aria-hidden="true" name="chevron-forward-outline" slot="end"></ion-icon>
      <ion-label>Configure and select APIs</ion-label>
    </ion-item>
    <ion-item>
      <ion-select [(ngModel)]="selectedAttributes" label="Configure Request Payload"
        (ionChange)="selectedAttributesChange($event)" [multiple]="true">
        <ion-select-option *ngFor="let attribute of allAttributes; index as position"
          [value]="attribute">{{attribute}}</ion-select-option>
        <ion-note color="medium"></ion-note>
      </ion-select>
    </ion-item>
    <ion-item (click)="requestParameterModalOpen = true">
      <ion-icon aria-hidden="true" name="chevron-forward-outline" slot="end"></ion-icon>
      <ion-label>Define Request Parameters</ion-label>
    </ion-item>
  </ion-list>
  <ion-grid id="image-grid" *ngIf="selectedAttributes.includes(Attribute.Images)">
    <ion-row>
      <ion-col size="6" *ngFor="let photo of photoService.photos; index as position">
        <ion-img [src]="photo"></ion-img>
      </ion-col>
    </ion-row>
  </ion-grid>
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="selectedAttributes.includes(Attribute.Images)">
    <ion-fab-button (click)="addPhotoToGallery()" [disabled]="photoService.photos.length >= 5">
      <ion-icon name="camera"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  <ion-fab vertical="bottom" horizontal="start" slot="fixed">
    <ion-fab-button (click)="submit()" [disabled]="photoService.photos.length == 0">
      <ion-icon name="send"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  <ion-fab vertical="bottom" horizontal="center" slot="fixed">
    <ion-fab-button (click)="clear()" [disabled]="photoService.photos.length == 0">
      <ion-icon name="close"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>

<ion-modal [isOpen]="photoService.croppingImage !== null" [backdropDismiss]="false">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Crop Image</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="photoService.imageNotCropped()">Skip</ion-button>
          <ion-button (click)="photoService.processImage()">
            <ion-icon slot="icon-only" name="checkmark"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <image-cropper [imageBase64]="photoService.croppingImage" [maintainAspectRatio]="true" [aspectRatio]="1 / 1"
        format="png" [hideResizeSquares]="photoService.isMobile" [transform]="photoService.transform" [autoCrop]="true"
        (imageCropped)="photoService.imageCropped($event)" (loadImageFailed)="photoService.loadImageFailed()"
        (imageLoaded)="photoService.imageLoaded()"></image-cropper>

    </ion-content>
  </ng-template>
</ion-modal>

<ion-modal [isOpen]="apiModalOpen">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Configure available APIs</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="apiModalOpen = false">Close</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <ion-item-divider>
        <ion-label>
          Existing
        </ion-label>
      </ion-item-divider>
      <ion-list>
        <ion-item>
          <ion-icon (click)="resetApi()" slot="start"
            [name]="selectedApi.name === 'Infoflora' ? 'checkmark-circle' : 'ellipse-outline'" size="large"></ion-icon>
          <ion-label (click)="resetApi()">
            <h3>Infoflora</h3>
            <p><small>{{urlInfoflora}}</small></p>
          </ion-label>
        </ion-item>
        <ion-item *ngFor="let customApi of customApis">
          <ion-icon (click)="selectApi(customApi)" slot="start"
            [name]="selectedApi.name === customApi.name ? 'checkmark-circle' : 'ellipse-outline'"
            size="large"></ion-icon>
          <ion-label (click)="selectApi(customApi)">
            <h3>{{customApi.name}}</h3>
            <p><small>{{customApi.url}}</small></p>
          </ion-label>
          <ion-icon slot="end" name="close-outline" size="large" (click)="removeCustomApi(customApi)"></ion-icon>
        </ion-item>
      </ion-list>
      <ion-item-divider>
      </ion-item-divider>
      <ion-item-divider>
        <ion-label>
          Add New
        </ion-label>
      </ion-item-divider>
      <ion-item>
        <ion-input [(ngModel)]="newCustomApi.name" placeholder="Enter API Name" label="Name"
          labelPlacement="stacked"></ion-input>
      </ion-item>
      <ion-item>
        <ion-input [(ngModel)]="newCustomApi.url" placeholder="Enter URL (start with https://)" label="URL"
          labelPlacement="stacked"></ion-input>
      </ion-item>
      <ion-button (click)="addCustomApi()" fill="clear" expand="full">Add
      </ion-button>
    </ion-content>
  </ng-template>
</ion-modal>

<ion-modal [isOpen]="requestParameterModalOpen">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Define Request Parameters</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="requestParameterModalOpen = false">Close</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <ion-item>
        <ion-input (ionChange)="numTaxonIdChange($event)" placeholder="Num. Taxon ID" label="Num. Taxon ID"
          labelPlacement="stacked" [(ngModel)]="num_taxon_id" type="number"></ion-input>
      </ion-item>
      <ion-item>
        <ion-input (ionChange)="reqTaxonIdChange($event)" placeholder="Req. Taxon ID" label="Req. Taxon ID"
          labelPlacement="stacked" [(ngModel)]="req_taxon_id" type="number"></ion-input>
      </ion-item>
    </ion-content>
  </ng-template>
</ion-modal>